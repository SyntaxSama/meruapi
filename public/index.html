<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeruAPI Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .status-ok::before {
      content: '✔';
      color: #34d399;
      font-weight: bold;
      margin-right: 0.5rem;
    }
    .status-error::before {
      content: '✖';
      color: #ef4444;
      font-weight: bold;
      margin-right: 0.5rem;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .table-container {
      transition: max-height 0.3s ease-in-out;
      overflow: hidden;
    }
    .table-container.collapsed {
      max-height: 0;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-left-color: #3b82f6;
      animation: spin 1s linear infinite;
      border-radius: 50%;
      width: 24px;
      height: 24px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-900 to-gray-800 min-h-screen text-gray-200 font-sans">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="text-center mb-10">
      <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500">
        MeruAPI Status
      </h1>
      <p class="mt-2 text-gray-400 text-sm sm:text-base">Real-time monitoring of MeruAPI services</p>
    </header>

    <div id="loading" class="flex justify-center items-center mb-8">
      <div class="spinner"></div>
      <span class="ml-3 text-gray-300">Checking API status...</span>
    </div>

    <section id="status-tables" class="space-y-6 hidden">
      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('streaming-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Streaming Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="streaming-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
                <th class="py-3 px-4 sm:px-6 text-left">Uptime</th>
              </tr>
            </thead>
            <tbody id="streaming-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('manga-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Manga Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="manga-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
                <th class="py-3 px-4 sm:px-6 text-left">Uptime</th>
              </tr>
            </thead>
            <tbody id="manga-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('torrent-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Torrent Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="torrent-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
                <th class="py-3 px-4 sm:px-6 text-left">Uptime</th>
              </tr>
            </thead>
            <tbody id="torrent-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="text-center mt-8">
      <p class="text-gray-400 text-sm">Updates every 5 minutes | Last updated: <span id="last-updated">Checking...</span></p>
      <p class="text-gray-500 text-xs mt-2">Note: Placeholder URLs for chapters, pages, episodes, and streams should be updated with valid URLs from search results.</p>
    </footer>
  </div>

  <script>
    const endpoints = {
      streaming: [
        { service: 'ZoroTV', name: 'Search', url: 'http://localhost:3000/api/streaming/zoro/search?q=one piece' },
        { service: 'ZoroTV', name: 'Episodes', url: 'http://localhost:3000/api/streaming/zoro/episodes?url=https://zoroto.com.in/anime/one-piece' },
        { service: 'ZoroTV', name: 'Stream', url: 'http://localhost:3000/api/streaming/zoro/stream?url=https://zoroto.com.in/one-piece-episode-10' },
        { service: 'AnimeGG', name: 'Search', url: 'http://localhost:3000/api/streaming/animegg/search?q=alya%20sometimes%20hides%20her%20feelings%20in%20russian' },
        { service: 'AnimeGG', name: 'Episodes', url: 'http://localhost:3000/api/streaming/animegg/episodes?url=https://www.animegg.org/series/tokidoki-bosotto-russia-go-de-dereru-tonari-no-alya-san' },
        { service: 'AnimeGG', name: 'Stream', url: 'http://localhost:3000/api/streaming/animegg/stream?url=https://www.animegg.org/tokidoki-bosotto-russia-go-de-dereru-tonari-no-alya-san-episode-1' },
        { service: 'Animepahe', name: 'Search', url: 'http://localhost:3000/api/streaming/animepahe/search?q=solo%20leveling' },
        { service: 'Animepahe', name: 'Episodes', url: 'http://localhost:3000/api/streaming/animepahe/episodes?anime_session_id=1895c0ee-ea1d-06a2-9068-da06ae3768af' },
        { service: 'Animepahe', name: 'Stream', url: 'http://localhost:3000/api/streaming/animepahe/stream?url=https://animepahe.ru/play/1895c0ee-ea1d-06a2-9068-da06ae3768af/70f1a28acb5b822b501d4174f256dbd6635e19aad4633b94147795b070542d6f' },
      ],
      manga: [
        { service: 'MangaFreak', name: 'Search', url: 'http://localhost:3000/api/manga/mangafreak?q=one piece' },
        { service: 'MangaFreak', name: 'Chapters', url: 'http://localhost:3000/api/manga/mangafreak/chapters?url=https://mangafreak.net/Manga/One_Piece' },
        { service: 'MangaFreak', name: 'Pages', url: 'http://localhost:3000/api/manga/mangafreak/pages?url=https://mangafreak.net/Read1_One_Piece_1' }
      ],
      torrents: [
        { service: 'AnimeTosho', name: 'Search', url: 'http://localhost:3000/api/torrent/animetosho?query=one piece' },
        { service: 'Nyaa', name: 'Search', url: 'http://localhost:3000/api/torrent/nyaa?query=one piece' },
        { service: 'AniRena', name: 'Search', url: 'http://localhost:3000/api/torrent/anirena?query=one piece' },
        { service: 'Seadex', name: 'Search', url: 'http://localhost:3000/api/torrent/seadex?query=Alya%20Sometimes%20Hides%20Her%20Feelings%20in%20Russian' }
      ]
    };

    async function checkEndpoint(endpoint) {
      try {
        const response = await fetch(endpoint.url);
        const data = await response.json();
        if (response.ok && (Array.isArray(data) ? data.length > 0 : data.result ? data.result.length > 0 : Object.keys(data).length > 0)) {
          return { status: 'OK', class: 'status-ok', uptime: '100%' };
        } else {
          return { status: 'Something went wrong when trying to ping this route', class: 'status-error', uptime: '0%' };
        }
      } catch (err) {
        return { status: 'Something went wrong when trying to ping this route', class: 'status-error', uptime: '0%' };
      }
    }

    async function updateStatus() {
      const loadingDiv = document.getElementById('loading');
      const tablesSection = document.getElementById('status-tables');
      const streamingTbody = document.getElementById('streaming-status');
      const mangaTbody = document.getElementById('manga-status');
      const torrentTbody = document.getElementById('torrent-status');

      streamingTbody.innerHTML = '';
      mangaTbody.innerHTML = '';
      torrentTbody.innerHTML = '';

      loadingDiv.classList.remove('hidden');
      tablesSection.classList.add('hidden');

      const [streamingResults, mangaResults, torrentResults] = await Promise.all([
        Promise.all(endpoints.streaming.map(checkEndpoint)),
        Promise.all(endpoints.manga.map(checkEndpoint)),
        Promise.all(endpoints.torrents.map(checkEndpoint))
      ]);

      streamingTbody.innerHTML = endpoints.streaming.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6 ${streamingResults[i].class}">${streamingResults[i].status}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${streamingResults[i].uptime === '100%' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${streamingResults[i].uptime}
            </span>
          </td>
        </tr>
      `).join('');

      mangaTbody.innerHTML = endpoints.manga.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6 ${mangaResults[i].class}">${mangaResults[i].status}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${mangaResults[i].uptime === '100%' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${mangaResults[i].uptime}
            </span>
          </td>
        </tr>
      `).join('');

      torrentTbody.innerHTML = endpoints.torrents.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6 ${torrentResults[i].class}">${torrentResults[i].status}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${torrentResults[i].uptime === '100%' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${torrentResults[i].uptime}
            </span>
          </td>
        </tr>
      `).join('');

      loadingDiv.classList.add('hidden');
      tablesSection.classList.remove('hidden');

      const now = new Date().toLocaleString('en-US', { timeZone: 'America/New_York' });
      document.getElementById('last-updated').textContent = now;
    }

    function toggleTable(tableId) {
      const table = document.getElementById(tableId);
      const toggleIcon = table.previousElementSibling.querySelector('span');
      table.classList.toggle('collapsed');
      toggleIcon.textContent = table.classList.contains('collapsed') ? '▶' : '▼';
    }

    updateStatus();
    setInterval(updateStatus, 300000);
  </script>
</body>
</html>