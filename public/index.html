<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeruAPI Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .status-ok::before {
      content: '✔';
      color: #34d399;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .status-error::before {
      content: '✖';
      color: #ef4444;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .table-container {
      transition: max-height 0.3s ease-in-out;
      overflow: hidden;
    }

    .table-container.collapsed {
      max-height: 0;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-left-color: #3b82f6;
      animation: spin 1s linear infinite;
      border-radius: 50%;
      width: 24px;
      height: 24px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .progress-bar {
      height: 8px;
      background-color: #4b5563;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background-color: #3b82f6;
      transition: width 0.3s ease-in;
    }
  </style>
</head>

<body class="bg-gradient-to-b from-gray-900 to-gray-800 min-h-screen text-gray-200 font-sans">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="text-center mb-10">
      <h1
        class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500">
        MeruAPI Status
      </h1>
      <p class="mt-2 text-gray-400 text-sm sm:text-base">Real-time monitoring of MeruAPI services</p>
    </header>

    <div id="loading" class="flex flex-col justify-center items-center mb-8">
      <div class="spinner"></div>
      <span id="current-check" class="mt-3 text-gray-300 text-sm">Checking API states...</span>
      <div class="w-64 mt-2 progress-bar">
        <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%"></div>
      </div>
      <span id="progress-percent" class="mt-1 text-gray-400 text-xs">0%</span>
    </div>

    <section id="status-tables" class="space-y-6 hidden">
      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('streaming-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Streaming Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="streaming-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
              </tr>
            </thead>
            <tbody id="streaming-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('manga-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Manga Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="manga-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
              </tr>
            </thead>
            <tbody id="manga-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('torrent-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Torrent Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="torrent-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
              </tr>
            </thead>
            <tbody id="torrent-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('metadata-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Metadata Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="metadata-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
              </tr>
            </thead>
            <tbody id="metadata-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

      <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center p-4 cursor-pointer" onclick="toggleTable('lnovel-table')">
          <h2 class="text-xl font-semibold text-cyan-400">Light Novel Services</h2>
          <span class="text-gray-400">▼</span>
        </div>
        <div id="lnovel-table" class="table-container">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-700 text-gray-300 uppercase text-xs sm:text-sm leading-normal">
                <th class="py-3 px-4 sm:px-6 text-left">Service</th>
                <th class="py-3 px-4 sm:px-6 text-left">Endpoint</th>
                <th class="py-3 px-4 sm:px-6 text-left">Status</th>
              </tr>
            </thead>
            <tbody id="lnovel-status" class="text-gray-200 text-sm font-light"></tbody>
          </table>
        </div>
      </div>

    </section>

    <footer class="text-center mt-8">
      <p class="text-gray-400 text-sm">Updates every 5 minutes | Last updated: <span
          id="last-updated">Checking...</span></p>
      <p class="text-gray-500 text-xs mt-2">Note: Placeholder URLs for chapters, pages, episodes, and streams should be
        updated with valid URLs from search results.</p>
    </footer>
  </div>

  <script>
    const endpoints = {
      streaming: [
        { service: 'ZoroTV', name: 'Search', url: 'http://localhost:3000/api/streaming/zoro/search?q=one piece' },
        { service: 'ZoroTV', name: 'Episodes', url: 'http://localhost:3000/api/streaming/zoro/episodes?url=https://zoroto.com.in/anime/one-piece' },
        { service: 'ZoroTV', name: 'Stream', url: 'http://localhost:3000/api/streaming/zoro/stream?url=https://zoroto.com.in/one-piece-episode-10' },
        { service: 'AnimeGG', name: 'Search', url: 'http://localhost:3000/api/streaming/animegg/search?q=alya%20sometimes%20hides%20her%20feelings%20in%20russian' },
        { service: 'AnimeGG', name: 'Episodes', url: 'http://localhost:3000/api/streaming/animegg/episodes?url=https://www.animegg.org/series/tokidoki-bosotto-russia-go-de-dereru-tonari-no-alya-san' },
        { service: 'AnimeGG', name: 'Stream', url: 'http://localhost:3000/api/streaming/animegg/stream?url=https://www.animegg.org/tokidoki-bosotto-russia-go-de-dereru-tonari-no-alya-san-episode-1' },
        { service: 'Animepahe', name: 'Search', url: 'http://localhost:3000/api/streaming/animepahe/search?q=solo%20leveling' },
        { service: 'Animepahe', name: 'Episodes', url: 'http://localhost:3000/api/streaming/animepahe/episodes?anime_session_id=1895c0ee-ea1d-06a2-9068-da06ae3768af' },
        { service: 'Animepahe', name: 'Stream', url: 'http://localhost:3000/api/streaming/animepahe/stream?url=https://animepahe.ru/play/1895c0ee-ea1d-06a2-9068-da06ae3768af/70f1a28acb5b822b501d4174f256dbd6635e19aad4633b94147795b070542d6f' },
        { service: '123animes', name: 'Search', url: 'http://localhost:3000/api/streaming/123animes/search?q=death%20note' },
        { service: '123animes', name: 'Episodes', url: 'http://localhost:3000/api/streaming/123animes/episodes?url=https://w1.123animes.ru/anime/death-note' },
        { service: '123animes', name: 'Stream', url: 'http://localhost:3000/api/streaming/123animes/stream?url=https://w1.123animes.ru/anime/death-note/episode/1' }

      ],
      manga: [
        { service: 'MangaFreak', name: 'Search', url: 'http://localhost:3000/api/manga/mangafreak?q=one piece' },
        { service: 'MangaFreak', name: 'Chapters', url: 'http://localhost:3000/api/manga/mangafreak/chapters?url=https://mangafreak.net/Manga/One_Piece' },
        { service: 'MangaFreak', name: 'Pages', url: 'http://localhost:3000/api/manga/mangafreak/pages?url=https://mangafreak.net/Read1_One_Piece_1' },
        { service: 'ComicK', name: 'Search', url: 'http://localhost:3000/api/manga/comick/search?q=frieren' },
        { service: 'ComicK', name: 'Chapters', url: 'http://localhost:3000/api/manga/comick/chapters?hid=0FiLFYD1&page=10' },
        { service: 'ComicK', name: 'Pages', url: 'http://localhost:3000/api/manga/comick/pages?hid=ClqZrOJS' },
        { service: 'MangaPill', name: 'Search', url: 'http://localhost:3000/api/manga/mangapill/search?q=Solo%20Leveling' },
        { service: 'MangaPill', name: 'Chapters', url: 'http://localhost:3000/api/manga/mangapill/chapters?url=https://mangapill.com/manga/12/solo-leveling' },
        { service: 'MangaPill', name: 'Pages', url: 'http://localhost:3000/api/manga/mangapill/pages?url=https://mangapill.com/chapters/12-10200000/solo-leveling-chapter-200' },
        { service: 'MangaFox', name: 'Search', url: 'http://localhost:3000/api/manga/mangafox/search?q=Solo%20Leveling' },
        { service: 'MangaFox', name: 'Chapters', url: 'http://localhost:3000/api/manga/mangafox/chapters?url=https://fanfox.net/manga/solo_leveling/' },
        { service: 'MangaFox', name: 'Pages', url: 'http://localhost:3000/api/manga/mangafox/pages?url=https://fanfox.net/manga/solo_leveling/c202/1.html' }
      ],
      torrents: [
        { service: 'AnimeTosho', name: 'Search', url: 'http://localhost:3000/api/torrent/animetosho?query=one piece' },
        { service: 'Nyaa', name: 'Search', url: 'http://localhost:3000/api/torrent/nyaa?query=one piece' },
        { service: 'AniRena', name: 'Search', url: 'http://localhost:3000/api/torrent/anirena?query=one piece' },
        { service: 'Seadex', name: 'Search', url: 'http://localhost:3000/api/torrent/seadex?query=Alya%20Sometimes%20Hides%20Her%20Feelings%20in%20Russian' }
      ],
      metadata: [
        { service: 'TheTVDB', name: 'Data', url: 'http://localhost:3000/api/metadata/thetvdb/data?url=https://www.thetvdb.com/series/kaoru-hana-wa-rin-to-saku' },
        { service: 'TheTVDB', name: 'Search', url: 'http://localhost:3000/api/metadata/thetvdb/search?q=the%20fragerant%20flower%20blooms%20with%20dignity' },
        { service: 'AnimeAPI', name: 'Trending', url: 'http://localhost:3000/api/metadata/animeapi/trending' },
        { service: 'AnimeAPI', name: 'Latest Releases', url: 'http://localhost:3000/api/metadata/animeapi/new' }
      ],
      lnovel: [
        { service: 'NovelBin', name: 'Search', url: 'http://localhost:3000/api/novels/novelbin/search?q=classroom%20of%20the%20elite' },
        { service: 'NovelBin', name: 'Chapters', url: 'http://localhost:3000/api/novels/novelbin/chapters?url=https://novelbin.me/novel-book/classroom-of-the-elite' },
        { service: 'NovelBin', name: 'Read', url: 'http://localhost:3000/api/novels/novelbin/read?url=https://novelbin.me/novel-book/classroom-of-the-elite/chapter-vol-1-ch-1' }
      ]
    };

    async function checkEndpoint(endpoint, retryCount = 2) {
      for (let i = 0; i <= retryCount; i++) {
        try {
          const response = await fetch(endpoint.url, { timeout: 10000 });
          const data = await response.json();
          if (response.ok && (Array.isArray(data) ? data.length > 0 : data.result ? data.result.length > 0 : Object.keys(data).length > 0)) {
            return { class: 'status-ok', status: 'Online' };
          }
          return { class: 'status-error', status: 'Offline' };
        } catch (err) {
          if (i < retryCount) {
            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
            continue;
          }
          return { class: 'status-error', status: 'Offline' };
        }
      }
    }


    async function updateStatus() {
      const loadingDiv = document.getElementById('loading');
      const currentCheck = document.getElementById('current-check');
      const progressBarFill = document.getElementById('progress-bar-fill');
      const progressPercent = document.getElementById('progress-percent');
      const tablesSection = document.getElementById('status-tables');
      const streamingTbody = document.getElementById('streaming-status');
      const mangaTbody = document.getElementById('manga-status');
      const torrentTbody = document.getElementById('torrent-status');
      const metadataTbody = document.getElementById('metadata-status');
      const lnovelTbody = document.getElementById('lnovel-status');
      const apiVersion = document.getElementById('api-version');

      streamingTbody.innerHTML = '';
      mangaTbody.innerHTML = '';
      torrentTbody.innerHTML = '';

      loadingDiv.classList.remove('hidden');
      tablesSection.classList.add('hidden');

      const allEndpoints = [
        ...endpoints.streaming.map(e => ({ ...e, category: 'streaming' })),
        ...endpoints.manga.map(e => ({ ...e, category: 'manga' })),
        ...endpoints.torrents.map(e => ({ ...e, category: 'torrents' })),
        ...endpoints.metadata.map(e => ({ ...e, category: 'metadata' })),
        ...endpoints.lnovel.map(e => ({ ...e, category: 'lnovel' }))
      ];
      const totalEndpoints = allEndpoints.length;
      let completed = 0;
      const streamingResults = [];
      const mangaResults = [];
      const torrentResults = [];
      const metadataResults = [];
      const lnovelResults = [];


      for (const endpoint of allEndpoints) {
        currentCheck.textContent = `Checking ${endpoint.service} ${endpoint.name}...`;
        const result = await checkEndpoint(endpoint);
        completed++;
        const percent = Math.round((completed / totalEndpoints) * 100);
        progressBarFill.style.width = `${percent}%`;
        progressPercent.textContent = `${percent}%`;

        if (endpoint.category === 'metadata') {
          metadataResults.push(result);
        } else if (endpoint.category === 'lnovel') {
          lnovelResults.push(result);
        } else if (endpoint.category === 'streaming') {
          streamingResults.push(result);
        } else if (endpoint.category === 'manga') {
          mangaResults.push(result);
        } else {
          torrentResults.push(result);
        }
      }

      streamingTbody.innerHTML = endpoints.streaming.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6" title="${endpoint.url}">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${streamingResults[i].status === 'Online' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${streamingResults[i].status}
            </span>
          </td>
        </tr>
      `).join('');

      mangaTbody.innerHTML = endpoints.manga.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6" title="${endpoint.url}">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${mangaResults[i].status === 'Online' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${mangaResults[i].status}
            </span>
          </td>
        </tr>
      `).join('');

      torrentTbody.innerHTML = endpoints.torrents.map((endpoint, i) => `
        <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
          <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
          <td class="py-3 px-4 sm:px-6" title="${endpoint.url}">${endpoint.name}</td>
          <td class="py-3 px-4 sm:px-6">
            <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${torrentResults[i].status === 'Online' ? 'bg-green-500' : 'bg-red-500'} text-white">
              ${torrentResults[i].status}
            </span>
          </td>
        </tr>
      `).join('');

      metadataTbody.innerHTML = endpoints.metadata.map((endpoint, i) => `
  <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
    <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
    <td class="py-3 px-4 sm:px-6" title="${endpoint.url}">${endpoint.name}</td>
    <td class="py-3 px-4 sm:px-6">
      <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${metadataResults[i].status === 'Online' ? 'bg-green-500' : 'bg-red-500'} text-white">
        ${metadataResults[i].status}
      </span>
    </td>
  </tr>
`).join('');

      lnovelTbody.innerHTML = endpoints.lnovel.map((endpoint, i) => `
  <tr class="border-b border-gray-700 hover:bg-gray-600 transition fade-in">
    <td class="py-3 px-4 sm:px-6">${endpoint.service}</td>
    <td class="py-3 px-4 sm:px-6" title="${endpoint.url}">${endpoint.name}</td>
    <td class="py-3 px-4 sm:px-6">
      <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full ${lnovelResults[i].status === 'Online' ? 'bg-green-500' : 'bg-red-500'} text-white">
        ${lnovelResults[i].status}
      </span>
    </td>
  </tr>
`).join('');


      loadingDiv.classList.add('hidden');
      tablesSection.classList.remove('hidden');

      const now = new Date().toLocaleString('en-US', { timeZone: 'America/New_York' });
      document.getElementById('last-updated').textContent = now;
    }

    function toggleTable(tableId) {
      const table = document.getElementById(tableId);
      const toggleIcon = table.previousElementSibling.querySelector('span');
      table.classList.toggle('collapsed');
      toggleIcon.textContent = table.classList.contains('collapsed') ? '▶' : '▼';
    }

    updateStatus();
    setInterval(updateStatus, 300000);
  </script>
</body>

</html>